<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON Layer Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 600px;
        }
    </style>
</head>
<body>
    <h1>GeoJSON Layer Visualization</h1>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const map = L.map('map').setView([0, 0], 2); // Set initial view to world
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // Function to parse CSV data
        function parseCSV(data) {
            const lines = data.trim().split('\n'); // Trim to remove any extra whitespace
            const result = [];
            const headers = lines[0].split(',').map(header => header.trim()); // Trim headers

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].trim(); // Trim the current line
                if (!currentLine) continue; // Skip empty lines

                const obj = {};
                const values = currentLine.split(',');

                // Ensure values match headers
                if (values.length !== headers.length) {
                    console.warn(`Warning: Skipped line due to header mismatch: ${currentLine}`);
                    continue;
                }

                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = values[j].trim();
                }
                result.push(obj);
            }
            return result;
        }

        // Load CSV file
        $.ajax({
            url: 'layer_config.csv', // Path to your CSV file
            dataType: 'text',
        }).done(function(data) {
            const layerConfig = parseCSV(data);
            loadLayers(layerConfig);
        });

        // Load GeoJSON layers based on configuration
        function loadLayers(layerConfig) {
            const layers = {};

            layerConfig.forEach(layer => {
                const { layer_name, attribute, type, color, fillColor } = layer;

                // Create a GeoJSON layer (replace with actual GeoJSON data for each layer)
                const geojsonData = {
                    "type": "FeatureCollection",
                    "features": [] // Add your GeoJSON features here
                };

                // Create a style function for each layer type
                const style = {
                    color: color,
                    fillColor: fillColor,
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.5
                };

                // Create GeoJSON layer and add it to the map
                const geoJsonLayer = L.geoJSON(geojsonData, {
                    style: style,
                    onEachFeature: function (feature, layer) {
                        layer.bindPopup(`${layer_name} - ${attribute}: ${type}`);
                    }
                });

                geoJsonLayer.addTo(map);
                layers[layer_name] = geoJsonLayer;
            });
        }
    </script>
</body>
</html>
